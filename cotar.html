<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cotador de Reservas - Icaraí Praia Hotel</title>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:Segoe UI, sans-serif; }
        body { background: linear-gradient(135deg, #667eea, #764ba2); min-height:100vh; padding:20px; color:#333; }
        .container { max-width:1300px; margin:20px auto; display:grid; grid-template-columns:1fr 1fr; gap:30px; }
        .calculator, .preview { background:#fff; padding:30px; border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,0.2); }
        h1, h2 { color:white; text-align:center; }
        .lang-btn { padding:8px 16px; background:rgba(255,255,255,0.2); color:white; border:none; border-radius:20px; margin:5px; cursor:pointer; }
        .lang-btn.active { background:white; color:#1a6bb3; font-weight:bold; }
        .form-label { font-weight:600; margin:15px 0 8px; display:block; }
        input, select { width:100%; padding:12px; border:2px solid #ddd; border-radius:10px; font-size:15px; }
        input:focus, select:focus { border-color:#1a6bb3; outline:none; }
        .group-container { background:#f8fbff; padding:25px; border-radius:15px; margin-bottom:20px; border:1px solid #e0e0e0; }
        .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:15px; }
        .grid-3 { display:grid; grid-template-columns:repeat(3,1fr); gap:15px; }
        .meal-options { background:#e3f2fd; padding:15px; border-radius:10px; margin-top:10px; border-left:5px solid #1a6bb3; display:none; }
        .add-group-btn { background:#1a6bb3; color:white; padding:15px; border:none; border-radius:12px; font-size:16px; cursor:pointer; width:100%; margin:20px 0; }
        .checkbox-group { margin:20px 0; font-weight:600; }
        .action-buttons { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:20px; }
        .action-btn { padding:16px; border:none; border-radius:12px; color:white; font-weight:bold; cursor:pointer; }
        .copy-btn { background:#1a6bb3; }
        .whatsapp-btn { background:#25D366; }
        .pdf-btn { background:#e74c3c; }
        .preview { overflow-y:auto; max-height:90vh; }
        .quotation-header { background:linear-gradient(135deg,#1a6bb3,#2c8cda); color:white; padding:40px; text-align:center; border-radius:15px 15px 0 0; }
        .hotel-name { font-size:32px; font-weight:900; }
        .group-box { background:#f8fdff; padding:25px; margin:25px 0; border-radius:12px; border-left:6px solid #1a6bb3; }
        .meal-detail { background:#e3f2fd; padding:12px; margin:10px 0; border-radius:8px; border-left:4px solid #1a6bb3; }
        .total-row { background:#1a6bb3; color:white; padding:25px; border-radius:12px; text-align:center; font-size:24px; font-weight:bold; }
        @media (max-width:900px) { .container { grid-template-columns:1fr; } .action-buttons { grid-template-columns:1fr; } }
    </style>
</head>
<body>
    <h1>Cotador de Reservas</h1>
    <p style="color:rgba(255,255,255,0.9);text-align:center;margin-bottom:20px;">Icaraí Praia Hotel</p>

    <div style="text-align:center;margin-bottom:20px;">
        <button class="lang-btn active" data-lang="pt">Português</button>
        <button class="lang-btn" data-lang="en">English</button>
    </div>

    <div class="container">
        <div class="calculator">
            <h2>Informações da Reserva</h2>

            <label class="form-label">Nome do Hóspede Principal</label>
            <input type="text" id="mainGuest" placeholder="Ex: João Silva" oninput="calculate()">

            <div class="checkbox-group">
                <input type="checkbox" id="showMealDetails" checked onchange="calculate()">
                <label for="showMealDetails">Exibir detalhes das refeições no voucher</label>
            </div>

            <div id="groupsContainer">
                <div class="group-container" data-group="0">
                    <h3 style="margin:0 0 20px;color:#1a6bb3;display:flex;justify-content:space-between;">
                        <span>Grupo 1</span>
                        <button onclick="this.closest('.group-container').remove();updateGroups();calculate()" style="display:none;background:#ff4444;color:white;border:none;padding:5px 10px;border-radius:8px;">×</button>
                    </h3>

                    <div class="grid-3">
                        <div><label class="form-label">Aptos</label><input type="number" class="qty" value="1" min="1" oninput="calculate()"></div>
                        <div><label class="form-label">Hóspedes por Apto</label>
                            <select class="guests" oninput="calculate()">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div><label class="form-label">Diária (R$)</label><input type="number" class="rate" step="0.01" value="0" oninput="calculate()"></div>
                    </div>

                    <div class="grid-2" style="margin-top:15px;">
                        <div><label class="form-label">Check-in</label><input type="date" class="checkin" oninput="calculate()"></div>
                        <div><label class="form-label">Check-out</label><input type="date" class="checkout" oninput="calculate()"></div>
                    </div>

                    <div style="margin-top:15px;">
                        <label class="form-label">Tipo de Pensão</label>
                        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;font-size:14px;">
                            <label><input type="radio" name="meal-0" value="breakfast" checked onchange="toggleMeal(this)"> Com Café</label>
                            <label><input type="radio" name="meal-0" value="noBreakfast" onchange="toggleMeal(this)"> Sem Café</label>
                            <label><input type="radio" name="meal-0" value="halfBoard" onchange="toggleMeal(this)"> Meia Pensão</label>
                            <label><input type="radio" name="meal-0" value="fullBoard" onchange="toggleMeal(this)"> Pensão Completa</label>
                        </div>
                        <div class="meal-options">
                            <label class="form-label">Valor refeição/pessoa (R$)</label>
                            <input type="number" class="meal-price" step="0.01" value="0" placeholder="0,00" oninput="calculate()">
                        </div>
                    </div>

                    <div style="margin-top:15px;">
                        <label class="form-label">Estacionamento</label>
                        <select class="parking" oninput="calculate()">
                            <option value="no">Não</option>
                            <option value="yes">Sim (R$ 45/dia)</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="add-group-btn" onclick="addGroup()">+ Adicionar Outro Grupo</button>

            <div style="margin:20px 0;">
                <input type="text" id="whatsappNumber" placeholder="WhatsApp com DDD (21999999999)" style="width:70%;padding:12px;border-radius:10px;border:2px solid #ddd;">
                <button class="whatsapp-btn" onclick="shareWhatsApp()" style="width:28%;padding:12px;">Enviar WhatsApp</button>
            </div>

            <div class="action-buttons">
                <button class="action-btn copy-btn" onclick="copyQuotation()">Copiar</button>
                <button class="action-btn pdf-btn" onclick="generatePDF()">Gerar PDF</button>
            </div>
        </div>

        <div class="preview" id="quotationPreview">
            <div style="padding:100px;text-align:center;color:#999;">Preencha os dados à esquerda para gerar a cotação</div>
        </div>
    </div>

<script>
const hotel = { name:"ICARAÍ PRAIA HOTEL", email:"reservas@icaraipraiahotel.com.br", tel:"(21) 2612-5030", site:"www.icaraipraiahotel.com.br" };
let groupCounter = 0;

function toggleMeal(radio) {
    const group = radio.closest('.group-container');
    const opt = group.querySelector('.meal-options');
    opt.style.display = (radio.value==='halfBoard' || radio.value==='fullBoard') ? 'block' : 'none';
    calculate();
}

function addGroup() {
    groupCounter++;
    const cont = document.getElementById('groupsContainer');
    const div = document.createElement('div');
    div.className = 'group-container';
    div.dataset.group = groupCounter;
    div.innerHTML = cont.querySelector('.group-container').innerHTML;
    div.querySelectorAll('input,select').forEach(el => { el.value = el.className.includes('qty')?'1':el.className.includes('guests')?'1':el.className.includes('rate')?'0':el.className.includes('meal-price')?'0':''; });
    div.querySelector('.meal-options').style.display = 'none';
    div.querySelector('h3 button').style.display = 'block';
    div.querySelector('h3 span').textContent = 'Grupo ' + (cont.children.length + 1);
    div.querySelectorAll('[name^="meal-"]')[0].name = 'meal-' + groupCounter;
    cont.appendChild(div);
    div.querySelectorAll('input,select').forEach(el => el.oninput = el.onchange = calculate);
    div.querySelectorAll('[onchange^="toggleMeal"]').forEach(el => el.setAttribute('onchange', 'toggleMeal(this)'));
    updateRemoveButtons();
    calculate();
}

function updateRemoveButtons() {
    document.querySelectorAll('.group-container').forEach((g,i) => {
        g.querySelector('h3 button').style.display = (document.querySelectorAll('.group-container').length > 1) ? 'block' : 'none';
    });
}

function calculate() {
    const showDetails = document.getElementById('showMealDetails').checked;
    let totalGeral = 0;
    let html = `<div class="quotation-header">
        <div class="hotel-name">${hotel.name}</div>
        <div style="font-size:24px;margin:10px 0;">COTAÇÃO DE RESERVA</div>
        <div style="background:#ff4444;color:white;padding:10px 25px;border-radius:50px;display:inline-block;font-weight:bold;">VÁLIDA POR 24 HORAS</div>
    </div>
    <div style="background:#fff8e1;padding:20px;margin:20px;border-left:6px solid #ffc107;font-weight:600;">
        Esta cotação possui validade de 24 horas.
    </div>
    <div style="padding:0 30px;">`;

    document.querySelectorAll('.group-container').forEach((group, idx) => {
        const qty = parseInt(group.querySelector('.qty').value) || 0;
        const guests = parseInt(group.querySelector('.guests').value) || 0;
        const rate = parseFloat(group.querySelector('.rate').value) || 0;
        const checkin = group.querySelector('.checkin').value;
        const checkout = group.querySelector('.checkout').value;
        const mealType = group.querySelector('input[name^="meal-"]:checked').value;
        const mealPrice = parseFloat(group.querySelector('.meal-price').value) || 0;
        const parking = group.querySelector('.parking').value;

        if (!checkin || !checkout || !qty || !rate) return;

        const nights = Math.max(1, Math.ceil((new Date(checkout) - new Date(checkin)) / 86400000));
        const totalPax = qty * guests;
        const aptoTotal = qty * rate * nights;

        let boardText = '';
        let mealTotal = 0;
        let detailHTML = '';

        if (mealType === 'breakfast') boardText = 'Café da manhã incluso';
        else if (mealType === 'noBreakfast') boardText = 'Sem café da manhã';
        else if (mealType === 'halfBoard') {
            mealTotal = mealPrice * totalPax * nights;
            boardText = showDetails ? `Meia Pensão (R$ ${mealPrice.toFixed(2)}/pessoa)` : 'Meia Pensão';
            if (showDetails) detailHTML = `<div class="meal-detail">${totalPax} × ${nights} noites × 1 refeição = R$ ${mealTotal.toFixed(2)}</div>`;
        }
        else if (mealType === 'fullBoard') {
            mealTotal = mealPrice * totalPax * nights * 2;
            boardText = showDetails ? `Pensão Completa (R$ ${mealPrice.toFixed(2)}/pessoa)` : 'Pensão Completa';
            if (showDetails) detailHTML = `<div class="meal-detail">${totalPax} × ${nights} noites × 2 refeições = R$ ${mealTotal.toFixed(2)}</div>`;
        }

        const parkingTotal = parking === 'yes' ? 45 * qty * nights : 0;
        const subtotal = aptoTotal + mealTotal + parkingTotal;
        const iss = subtotal * 0.02;
        const grupoTotal = subtotal + iss;
        totalGeral += grupoTotal;

        const fmt = v => 'R$ ' + v.toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.');

        html += `
        <div class="group-box">
            <strong>GRUPO ${idx+1}</strong><br><br>
            ${qty} apartamento(s) × ${guests} hóspede(s) × R$ ${rate.toFixed(2)} × ${nights} noite(s)<br>
            Período: <strong>${new Date(checkin).toLocaleDateString('pt-BR')} → ${new Date(checkout).toLocaleDateString('pt-BR')}</strong><br>
            Pensão: <strong>${boardText}</strong><br>
            Estacionamento: <strong>${parking==='yes'?'Sim':'Não'}</strong><br><br>
            ${detailHTML}
            <div style="border-top:2px dashed #ccc;padding-top:15px;margin-top:15px;font-size:18px;">
                <strong>Total do Grupo ${idx+1}: ${fmt(grupoTotal)}</strong>
            </div>
        </div>`;
    });

    const fmtTotal = 'R$ ' + totalGeral.toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.');
    html += `<div class="total-row">TOTAL GERAL (com ISS 2% incluso)<br>${fmtTotal}</div></div>
    <div style="background:#1a6bb3;color:white;padding:30px;text-align:center;">
        <strong>${hotel.name}</strong><br>${hotel.email} • ${hotel.tel}<br>${hotel.site}
    </div>`;

    document.getElementById('quotationPreview').innerHTML = totalGeral > 0 ? html : '<div style="padding:100px;text-align:center;color:#999;">Preencha os dados à esquerda</div>';
}

function copyQuotation() {
    const range = document.createRange();
    range.selectNode(document.get NbElementById('quotationPreview'));
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    document.execCommand('copy');
    window.getSelection().removeAllRanges();
    alert('Cotação copiada!');
}

function shareWhatsApp() {
    let num = document.getElementById('whatsappNumber').value.replace(/\D/g,'');
    if (num.length < 10) return alert('Número inválido');
    if (!num.startsWith('55')) num = '55' + num;
    const text = document.getElementById('quotationPreview').innerText;
    window.open(`https://wa.me/${num}?text=${encodeURIComponent(text)}`,'_blank');
}

function generatePDF() {
    const { jsPDF } = window.jspdf;
    html2canvas(document.getElementById('quotationPreview'), {scale:2}).then(canvas => {
        const img = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p','mm','a4');
        const w = pdf.internal.pageSize.getWidth();
        const h = (canvas.height * w) / canvas.width;
        pdf.addImage(img,'PNG',0,0,w,h);
        pdf.save('Cotacao_Icarai_Praia_Hotel.pdf');
    });
}

// Inicializa tudo
document.querySelectorAll('.lang-btn').forEach(b => b.onclick = () => {
    document.querySelectorAll('.lang-btn').forEach(x => x.classList.remove('active'));
    b.classList.add('active');
});
calculate();
</script>
</body>
</html>
