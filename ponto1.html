<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cartão de Ponto</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            padding: 30px;
        }

        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .search-box, select, input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .search-box:focus, select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
        }

        .employee-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        .employee-item {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .employee-item:hover {
            background-color: #f8f9fa;
        }

        .employee-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .employee-role {
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .employee-order {
            background: #3498db;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .preview-area {
            background: white;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 25px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .preview-area h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        /* Cartão com dimensões corretas: 86 x 190 mm */
        .card-preview {
            width: 86mm;
            height: 190mm;
            font-family: 'Courier New', monospace;
            font-size: 13.455px;
            line-height: 1.3;
            background: white;
            position: relative;
            overflow: hidden;
            border: 1px solid #ccc;
        }

        .card-content {
            padding: 3mm;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Posicionamento absoluto para as informações variáveis */
        .variable-field {
            position: absolute;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Fonte 15% menor para os horários */
        .horario-field {
            font-size: 11.44px;
        }

        /* POSIÇÕES ESPECÍFICAS AJUSTADAS - CORRIGINDO A SOBREPOSIÇÃO DOS HORÁRIOS */
        .n-ordem { top: 6mm; left: 4mm; }
        .empregador { top: 6mm; left: 39mm; }
        .atividade-economica { top: 13mm; left: 4mm; }
        .cnpj { top: 13mm; left: 39mm; }
        .endereco { top: 18mm; left: 4mm; }
        .funcionario { top: 23mm; left: 4mm; width: 75mm; }
        .ctps { top: 28mm; left: 4mm; width: 18mm; }
        .registro { top: 28mm; left: 24mm; width: 18mm; }
        .funcao { top: 40mm; left: 48mm; width: 35mm; }
        .mes { top: 34mm; left: 4mm; }
        .ano { top: 34mm; left: 54mm; }
        
        /* Horário de trabalho com fonte 15% menor - POSIÇÕES CORRIGIDAS PARA EVITAR SOBREPOSIÇÃO */
        .entrada { top: 48mm; left: 4mm; width: 15mm; }
        .intervalo { top: 48mm; left: 22mm; width: 25mm; }
        .saida { top: 48mm; left: 50mm; width: 15mm; }
        .rep-semanal { top: 48mm; left: 68mm; width: 15mm; }

        .selected-count {
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .bulk-btn {
            padding: 8px 16px;
            border: 1px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .bulk-btn:hover {
            background: #3498db;
            color: white;
        }

        .month-selector {
            display: flex;
            gap: 10px;
        }

        .month-selector .form-group {
            flex: 2;
        }

        .month-selector .form-group:last-child {
            flex: 1;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: block;
            padding: 12px 24px;
            background: #f39c12;
            color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .file-label:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .preview-area {
                min-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sistema de Cartão de Ponto</h1>
        </div>
        
        <div class="main-content">
            <div class="controls">
                <div class="bulk-actions">
                    <button class="bulk-btn" onclick="selectAll()">Selecionar Todos</button>
                    <button class="bulk-btn" onclick="deselectAll()">Limpar Seleção</button>
                </div>

                <div class="form-group month-selector">
                    <div class="form-group">
                        <label>Mês:</label>
                        <select id="monthSelect">
                            <option value="JANEIRO">Janeiro</option>
                            <option value="FEVEREIRO">Fevereiro</option>
                            <option value="MARÇO">Março</option>
                            <option value="ABRIL">Abril</option>
                            <option value="MAIO">Maio</option>
                            <option value="JUNHO" selected>Junho</option>
                            <option value="JULHO">Julho</option>
                            <option value="AGOSTO">Agosto</option>
                            <option value="SETEMBRO">Setembro</option>
                            <option value="OUTUBRO">Outubro</option>
                            <option value="NOVEMBRO">Novembro</option>
                            <option value="DEZEMBRO">Dezembro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ano:</label>
                        <input type="number" id="yearInput" value="2025" min="1900" max="2100">
                    </div>
                </div>

                <div class="form-group">
                    <label>Buscar Funcionário:</label>
                    <input type="text" class="search-box" id="searchInput" placeholder="Digite o nome ou função..." onkeyup="filterEmployees()">
                </div>

                <div class="form-group">
                    <label>Funcionários <span id="selectedCount" class="selected-count">0</span>:</label>
                    <div class="employee-list" id="employeeList">
                        <!-- Lista será populada via JavaScript -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="generateSelected()">
                        Imprimir Selecionados
                    </button>
                    <button class="btn btn-success" onclick="generateAll()">
                        Imprimir Todos
                    </button>
                    <button class="btn btn-warning" onclick="exportToExcel()">
                        Exportar para Excel
                    </button>
                    <label for="excelFile" class="file-label">
                        Importar do Excel
                    </label>
                    <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls" onchange="importFromExcel(event)">
                </div>
            </div>

            <div class="preview-area">
                <h3>Pré-visualização do Cartão</h3>
                <div class="card-preview" id="cardPreview">
                    <!-- Preview será gerado aqui -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // LISTA DE FUNCIONÁRIOS ATUALIZADA COM HORÁRIOS CORRETAMENTE FORMATADOS COM "/"
        let employees = [
            { id: 1, name: "ARYANNE K. DA SILVA PEREIRA", role: "JOVEM APRENDIZ", admission: "28/03/2025", entrada: "12:00", intervalo: "16:00/16:15", saida: "18:00", ctps: "", registro: "" },
            { id: 2, name: "CARINA ALVES CORDEIRO", role: "GARÇONETE", admission: "28/03/2025", entrada: "05:30", intervalo: "11:00/12:00", saida: "13:50", ctps: "", registro: "" },
            { id: 3, name: "CELIA LUIZA DA SILVA", role: "ARRUMADEIRA", admission: "09/09/2014", entrada: "09:00", intervalo: "12:00/13:00", saida: "17:20", ctps: "", registro: "" },
            { id: 4, name: "ULLEN GABRIEL LUZ SANTOS", role: "SUP. RESERVAS", admission: "20/05/2019", entrada: "09:00", intervalo: "12:00/13:00", saida: "17:20", ctps: "", registro: "" },
            { id: 5, name: "INACIA NEMEZIO DE LIMA", role: "ARRUMADEIRA", admission: "21/12/2016", entrada: "09:00", intervalo: "13:00/14:00", saida: "21:00", ctps: "", registro: "" },
            { id: 6, name: "ICARO TARANTO RODRIGUES", role: "RECEP C/ DIREÇÃO", admission: "25/02/2025", entrada: "19:00", intervalo: "01:00/02:00", saida: "07:00", ctps: "", registro: "" },
            { id: 7, name: "EREVALDO DA SILVA LIRIO", role: "GARÇON", admission: "10/04/2019", entrada: "06:00", intervalo: "10:45/11:45", saida: "14:20", ctps: "", registro: "" },
            { id: 8, name: "GREGORIO DE SOUSA MAGALHAES", role: "AJ. DE COZINHA", admission: "29/01/2025", entrada: "05:30", intervalo: "10:00/11:00", saida: "13:50", ctps: "", registro: "" },
            { id: 9, name: "TATIANE SILVA MARINS", role: "ARRUMADEIRA", admission: "08/04/2024", entrada: "06:00", intervalo: "11:00/12:00", saida: "14:20", ctps: "", registro: "" },
            { id: 10, name: "CREDIOMAR VERAS DE SOUSA", role: "GOVERNANTA", admission: "01/05/2013", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 11, name: "VICTOR SILVA RAMOS", role: "AUX S. GERAIS", admission: "18/12/2024", entrada: "07:00", intervalo: "12:00/13:00", saida: "18:00", ctps: "", registro: "" },
            { id: 12, name: "VANESSA DE BRITO ARAUJO", role: "RECEPCIONISTA", admission: "23/08/2010", entrada: "07:00", intervalo: "12:00/13:00", saida: "19:00", ctps: "", registro: "" },
            { id: 13, name: "LAERCIO DIAS FELICIO", role: "MANOBRISTA", admission: "18/09/2012", entrada: "06:00", intervalo: "11:00/12:00", saida: "18:00", ctps: "", registro: "" },
            { id: 14, name: "DANIEL ALVES VIANA", role: "RECEPCIONISTA", admission: "06/11/2025", entrada: "07:00", intervalo: "12:00/13:00", saida: "15:20", ctps: "", registro: "" },
            { id: 15, name: "HELOISA CRISTINA DOS S. FIGUEIREDO", role: "ARRUMADEIRA", admission: "16/12/2015", entrada: "08:00", intervalo: "12:00/13:00", saida: "20:00", ctps: "", registro: "" },
            { id: 16, name: "LUCIANA FELIX", role: "ASS. ADMINISTRATIVO", admission: "20/05/2003", entrada: "09:00", intervalo: "13:00/14:00", saida: "16:00", ctps: "", registro: "" },
            { id: 17, name: "VANIA THEREZA B. BORGES", role: "ARRUMADEIRA", admission: "24/12/2020", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 18, name: "LORRANE DOS SANTOS PEREIRA", role: "AUX S. GERAIS", admission: "28/04/2025", entrada: "15:00", intervalo: "19:00/20:00", saida: "23:00", ctps: "", registro: "" },
            { id: 19, name: "WANDERLEY DA SILVA MACEDO", role: "GERENTE HOTEL", admission: "29/06/2010", entrada: "07:00", intervalo: "12:00/13:00", saida: "15:20", ctps: "", registro: "" },
            { id: 20, name: "ROBSON LUIZ DE M. NORBERTO JR", role: "MANOBRISTA", admission: "21/09/2020", entrada: "06:00", intervalo: "11:00/12:00", saida: "18:00", ctps: "", registro: "" },
            { id: 21, name: "THAIS HELENA T. DA SILVA", role: "COZINHEIRO", admission: "02/06/2023", entrada: "13:40", intervalo: "16:00/17:00", saida: "22:00", ctps: "", registro: "" },
            { id: 22, name: "LUIZ CLAUDIO GLORIA", role: "AJUDANTE DE COZINHA", admission: "18/11/2009", entrada: "13:40", intervalo: "17:00/18:00", saida: "22:00", ctps: "", registro: "" },
            { id: 23, name: "MARIA CRISTINA SILVA MOREIRA", role: "ARRUMADEIRA", admission: "03/11/2010", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 24, name: "MARIA CLAUDIA V. DE B. SILVA", role: "RECEPCIONISTA", admission: "02/05/2017", entrada: "07:00", intervalo: "12:00/13:00", saida: "19:00", ctps: "", registro: "" },
            { id: 25, name: "FABIOLA LUCIENE R. MARCELLO", role: "AUX S. GERAIS", admission: "13/06/2025", entrada: "08:00", intervalo: "12:00/13:00", saida: "20:00", ctps: "", registro: "" },
            { id: 26, name: "ANDERSON LUIS DE MELO", role: "GARÇON", admission: "22/04/2021", entrada: "14:20", intervalo: "16:00/17:00", saida: "22:40", ctps: "", registro: "" },
            { id: 27, name: "ANDRE DA CRUZ ANJOS", role: "SUB CHF DE COZINHA", admission: "04/04/2023", entrada: "05:30", intervalo: "09:30/10:30", saida: "13:50", ctps: "", registro: "" },
            { id: 28, name: "SHAMYG K. DA S. MESSIAS", role: "AUX S. GERAIS", admission: "28/10/2025", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 29, name: "SALOMAO LUIS DA SILVA", role: "GERENTE SENIOR", admission: "11/06/2002", entrada: "09:00", intervalo: "14:00/15:00", saida: "17:20", ctps: "", registro: "" },
            { id: 30, name: "GUSTAVO COSTA DE LIMA", role: "CHF DE RECEP", admission: "13/12/2023", entrada: "18:00", intervalo: "01:00/02:00", saida: "06:00", ctps: "", registro: "" },
            { id: 31, name: "LUIZ MIGUEL DA S. ARAUJO", role: "JOVEM APRENDIZ", admission: "28/08/2025", entrada: "18:00", intervalo: "", saida: "22:00", ctps: "", registro: "" },
            { id: 32, name: "WAGNO DE PAULA FERREIRA", role: "ELETRICISTA", admission: "12/04/2010", entrada: "08:00", intervalo: "11:00/12:00", saida: "16:00", ctps: "", registro: "" },
            { id: 34, name: "JOCELI DA SILVA FERREIRA", role: "AUX S. GERAIS", admission: "06/11/2025", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 35, name: "JORGE LUIZ F. POLEGARIO", role: "GARÇON", admission: "01/06/2022", entrada: "14:20", intervalo: "16:00/17:00", saida: "22:40", ctps: "", registro: "" },
            { id: 36, name: "ERICK PEREIRA DA COSTA", role: "RECEP C/ DIREÇÃO", admission: "29/03/2025", entrada: "07:00", intervalo: "13:00/14:00", saida: "19:00", ctps: "", registro: "" },
            { id: 37, name: "LUCIANO FERREIRA DOS REIS", role: "RECEP C/ DIREÇÃO", admission: "18/03/2022", entrada: "19:00", intervalo: "00:00/01:00", saida: "07:00", ctps: "", registro: "" },
            { id: 38, name: "CARLOS EDUARDO SILVA", role: "MANOBRISTA", admission: "29/01/2025", entrada: "14:00", intervalo: "16:00/17:00", saida: "22:00", ctps: "", registro: "" },
            { id: 39, name: "EDILZA SOUZA NOGUEIRA", role: "ARRUMADEIRA", admission: "22/06/2024", entrada: "15:00", intervalo: "19:00/20:00", saida: "23:00", ctps: "", registro: "" },
            { id: 40, name: "FABIO DA TRINDADE LIMA", role: "RECEP C/ DIREÇÃO", admission: "11/01/2024", entrada: "19:00", intervalo: "01:00/02:00", saida: "07:00", ctps: "", registro: "" },
            { id: 41, name: "FABIANO CARDIM DE ARAÚJO", role: "MAITRE", admission: "04/09/2024", entrada: "13:40", intervalo: "17:00/18:00", saida: "22:00", ctps: "", registro: "" },
            { id: 42, name: "MAYCON J. DOS S. DA SILVA", role: "OF.DE MANUTENÇÃO", admission: "06/09/2025", entrada: "08:00", intervalo: "12:00/13:00", saida: "16:20", ctps: "", registro: "" },
            { id: 44, name: "GENESIO COSTA SILVA", role: "COZINHEIRO", admission: "03/04/2023", entrada: "05:30", intervalo: "10:00/11:00", saida: "13:50", ctps: "", registro: "" },
            { id: 45, name: "LUIZ OTAVIO B. S. CONCEICAO", role: "JOVEM APRENDIZ", admission: "28/08/2025", entrada: "11:00", intervalo: "16:00/16:15", saida: "17:00", ctps: "", registro: "" }
        ];

        let selectedEmployees = new Set();

        // Inicializar a aplicação
        function initializeApp() {
            renderEmployeeList();
            updateSelectedCount();
            if (employees.length > 0) {
                showPreview(employees[0]);
            }
            document.getElementById('monthSelect').addEventListener('change', updatePreview);
            document.getElementById('yearInput').addEventListener('change', updatePreview);
        }

        function updatePreview() {
            if (selectedEmployees.size > 0) {
                const firstSelectedId = Array.from(selectedEmployees)[0];
                const employee = employees.find(emp => emp.id === firstSelectedId);
                if (employee) showPreview(employee);
            } else if (employees.length > 0) {
                showPreview(employees[0]);
            }
        }

        // Renderizar lista de funcionários
        function renderEmployeeList(filteredEmployees = employees) {
            const employeeList = document.getElementById('employeeList');
            employeeList.innerHTML = '';

            filteredEmployees.forEach(employee => {
                const isSelected = selectedEmployees.has(employee.id);
                const employeeItem = document.createElement('div');
                employeeItem.className = `employee-item ${isSelected ? 'selected' : ''}`;
                employeeItem.onclick = () => toggleEmployee(employee.id);
                
                employeeItem.innerHTML = `
                    <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleEmployee(${employee.id})">
                    <div class="employee-order">${employee.id}</div>
                    <div class="employee-info">
                        <div class="employee-name">${employee.name}</div>
                        <div class="employee-role">${employee.role} • Adm: ${employee.admission}</div>
                    </div>
                `;
                
                employeeList.appendChild(employeeItem);
            });
        }

        // Alternar seleção de funcionário
        function toggleEmployee(employeeId) {
            if (selectedEmployees.has(employeeId)) {
                selectedEmployees.delete(employeeId);
            } else {
                selectedEmployees.add(employeeId);
            }
            updateSelectedCount();
            renderEmployeeList();
            
            const employee = employees.find(emp => emp.id === employeeId);
            if (employee) {
                showPreview(employee);
            }
        }

        // Selecionar todos os funcionários
        function selectAll() {
            employees.forEach(employee => selectedEmployees.add(employee.id));
            updateSelectedCount();
            renderEmployeeList();
        }

        // Desmarcar todos os funcionários
        function deselectAll() {
            selectedEmployees.clear();
            updateSelectedCount();
            renderEmployeeList();
        }

        // Atualizar contador de selecionados
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedEmployees.size;
        }

        // Filtrar funcionários
        function filterEmployees() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = employees.filter(employee => 
                employee.name.toLowerCase().includes(searchTerm) ||
                employee.role.toLowerCase().includes(searchTerm)
            );
            renderEmployeeList(filtered);
        }

        // Obter mês e ano atuais
        function getMonthYear() {
            const month = document.getElementById('monthSelect').value;
            const year = document.getElementById('yearInput').value;
            return { month, year };
        }

        // Mostrar pré-visualização
        function showPreview(employee) {
            const { month, year } = getMonthYear();
            const preview = document.getElementById('cardPreview');
            
            preview.innerHTML = `
                <div class="card-content">
                    <div class="variable-field n-ordem"><strong>${employee.id.toString().padStart(2, '0')}</strong></div>
                    <div class="variable-field empregador"><strong>ICARAI P HOTEL</strong></div>
                    <div class="variable-field atividade-economica"><strong>HOTEL</strong></div>
                    <div class="variable-field cnpj"><strong>27.890.847/0001-45</strong></div>
                    <div class="variable-field endereco"><strong>R BELISÁRIO AUGUSTO, Nº.21 – ICARAI</strong></div>
                    <div class="variable-field funcionario"><strong>${employee.name}</strong></div>
                    <div class="variable-field ctps"><strong>${employee.ctps}</strong></div>
                    <div class="variable-field registro"><strong>${employee.registro}</strong></div>
                    <div class="variable-field funcao"><strong>${employee.role}</strong></div>
                    <div class="variable-field mes"><strong>${month}</strong></div>
                    <div class="variable-field ano"><strong>${year}</strong></div>
                    
                    <div class="variable-field entrada horario-field"><strong>${employee.entrada}</strong></div>
                    <div class="variable-field intervalo horario-field"><strong>${employee.intervalo}</strong></div>
                    <div class="variable-field saida horario-field"><strong>${employee.saida}</strong></div>
                    <div class="variable-field rep-semanal horario-field"><strong>12/36</strong></div>
                </div>
            `;
        }

        // Gerar cartões para funcionários selecionados
        function generateSelected() {
            if (selectedEmployees.size === 0) {
                alert('Por favor, selecione pelo menos um funcionário.');
                return;
            }

            const selected = employees.filter(emp => selectedEmployees.has(emp.id));
            printCards(selected);
        }

        // Gerar cartões para todos os funcionários
        function generateAll() {
            printCards(employees);
        }

        // Função principal de impressão de cartões
        function printCards(employeesToPrint) {
            const { month, year } = getMonthYear();
            
            let printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Cartões de Ponto</title>
                    <meta charset="UTF-8">
                    <style>
                        * {
                            margin: 0 !important;
                            padding: 0 !important;
                            border: 0 !important;
                            box-sizing: border-box;
                        }
                        
                        html, body {
                            margin: 0 !important;
                            padding: 0 !important;
                            width: 100% !important;
                            height: 100% !important;
                            font-family: 'Courier New', monospace !important;
                            background: white !important;
                        }
                        
                        .page {
                            width: 86mm !important;
                            height: 190mm !important;
                            page-break-after: always !important;
                            position: relative !important;
                            background: white !important;
                            font-size: 13.455px !important;
                            line-height: 1.3 !important;
                            overflow: hidden !important;
                            margin: 0 !important;
                            padding: 0 !important;
                        }
                        
                        .variable-field {
                            position: absolute !important;
                            font-weight: bold !important;
                            white-space: nowrap !important;
                        }
                        
                        .horario-field {
                            font-size: 11.44px !important;
                        }
                        
                        /* POSIÇÕES AJUSTADAS PARA IMPRESSÃO - CORRIGINDO SOBREPOSIÇÃO DOS HORÁRIOS */
                        .n-ordem { top: 6mm !important; left: 4mm !important; }
                        .empregador { top: 6mm !important; left: 39mm !important; }
                        .atividade-economica { top: 13mm !important; left: 4mm !important; }
                        .cnpj { top: 13mm !important; left: 39mm !important; }
                        .endereco { top: 18mm !important; left: 4mm !important; }
                        .funcionario { top: 23mm !important; left: 4mm !important; width: 75mm !important; }
                        .ctps { top: 28mm !important; left: 4mm !important; width: 18mm !important; }
                        .registro { top: 28mm !important; left: 24mm !important; width: 18mm !important; }
                        .funcao { top: 40mm !important; left: 48mm !important; width: 35mm !important; }
                        .mes { top: 34mm !important; left: 4mm !important; }
                        .ano { top: 34mm !important; left: 54mm !important; }
                        
                        /* POSIÇÕES CORRIGIDAS PARA OS HORÁRIOS COM ESPAÇAMENTO ADEQUADO */
                        .entrada { top: 48mm !important; left: 4mm !important; width: 15mm !important; }
                        .intervalo { top: 48mm !important; left: 22mm !important; width: 25mm !important; }
                        .saida { top: 48mm !important; left: 50mm !important; width: 15mm !important; }
                        .rep-semanal { top: 48mm !important; left: 68mm !important; width: 15mm !important; }
                        
                        @page {
                            margin: 0 !important;
                            size: 86mm 190mm;
                        }
                    </style>
                </head>
                <body style="margin: 0 !important; padding: 0 !important;">
            `;
            
            employeesToPrint.forEach(employee => {
                printContent += `
                    <div class="page">
                        <div class="variable-field n-ordem"><strong>${employee.id.toString().padStart(2, '0')}</strong></div>
                        <div class="variable-field empregador"><strong>ICARAI P HOTEL</strong></div>
                        <div class="variable-field atividade-economica"><strong>HOTEL</strong></div>
                        <div class="variable-field cnpj"><strong>27.890.847/0001-45</strong></div>
                        <div class="variable-field endereco"><strong>R BELISÁRIO AUGUSTO, Nº.21 – ICARAI</strong></div>
                        <div class="variable-field funcionario"><strong>${employee.name}</strong></div>
                        <div class="variable-field ctps"><strong>${employee.ctps}</strong></div>
                        <div class="variable-field registro"><strong>${employee.registro}</strong></div>
                        <div class="variable-field funcao"><strong>${employee.role}</strong></div>
                        <div class="variable-field mes"><strong>${month}</strong></div>
                        <div class="variable-field ano"><strong>${year}</strong></div>
                        
                        <div class="variable-field entrada horario-field"><strong>${employee.entrada}</strong></div>
                        <div class="variable-field intervalo horario-field"><strong>${employee.intervalo}</strong></div>
                        <div class="variable-field saida horario-field"><strong>${employee.saida}</strong></div>
                        <div class="variable-field rep-semanal horario-field"><strong>12/36</strong></div>
                    </div>
                `;
            });
            
            printContent += `
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.open();
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                setTimeout(() => printWindow.close(), 100);
            }, 250);
        }

        // Exportar dados para Excel
        function exportToExcel() {
            // Preparar dados para exportação
            const data = employees.map(emp => ({
                'N Ordem': emp.id,
                'Nome': emp.name,
                'Função': emp.role,
                'Admissão': emp.admission,
                'Entrada': emp.entrada,
                'Intervalo': emp.intervalo,
                'Saída': emp.saida,
                'CTPS': emp.ctps,
                'Registro': emp.registro
            }));

            // Criar planilha
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Funcionários");

            // Exportar arquivo
            XLSX.writeFile(wb, "cartoes_ponto_funcionarios.xlsx");
        }

        // Importar dados do Excel
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Obter primeira planilha
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Atualizar dados dos funcionários
                    updateEmployeesFromExcel(jsonData);
                    
                    // Limpar input de arquivo
                    event.target.value = '';
                } catch (error) {
                    alert('Erro ao importar arquivo. Verifique se o formato está correto.');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Atualizar funcionários com dados do Excel
        function updateEmployeesFromExcel(excelData) {
            // Para cada linha do Excel
            excelData.forEach(row => {
                const nOrdem = row['N Ordem'];
                const employee = employees.find(emp => emp.id === nOrdem);
                
                if (employee) {
                    // Atualizar dados do funcionário
                    if (row['Nome']) employee.name = row['Nome'];
                    if (row['Função']) employee.role = row['Função'];
                    if (row['Entrada']) employee.entrada = row['Entrada'];
                    if (row['Intervalo']) employee.intervalo = row['Intervalo'];
                    if (row['Saída']) employee.saida = row['Saída'];
                    if (row['CTPS']) employee.ctps = row['CTPS'];
                    if (row['Registro']) employee.registro = row['Registro'];
                }
            });
            
            // Atualizar interface
            renderEmployeeList();
            updateSelectedCount();
            
            // Mostrar mensagem de sucesso
            alert(`Dados de ${excelData.length} funcionários atualizados com sucesso!`);
        }

        // Inicializar quando a página carregar
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
