<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Movimentação Financeira</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .input-group {
            margin-bottom: 10px;
        }
        label {
            display: inline-block;
            width: 200px;
        }
        input, select {
            padding: 5px;
            width: 200px;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result-section {
            overflow-x: auto;
        }
        .total-row {
            font-weight: bold;
            background-color: #e6f7ff;
        }
        .status-correct {
            color: green;
        }
        .status-incorrect {
            color: red;
        }
        .forma-pagamento-group {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            background-color: #fff;
        }
        .tipo-cartao {
            margin-left: 20px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Calculadora de Movimentação Financeira</h1>
    
    <div class="input-section">
        <h2>Dados de Entrada</h2>
        <div class="input-group">
            <label for="data">Data:</label>
            <input type="text" id="data" placeholder="DD/MM/AAAA" value="01/04/2025">
        </div>
        <div class="input-group">
            <label for="movimento">Movimento Total (R$):</label>
            <input type="text" id="movimento" placeholder="12.992,40" value="12.992,40">
        </div>
        
        <h3>Formas de Pagamento</h3>
        <div id="formas-pagamento-container">
            <!-- As formas de pagamento serão adicionadas dinamicamente aqui -->
        </div>
        
        <button id="adicionar-cartao">Adicionar Cartão</button>
        <button id="adicionar-outra-forma">Adicionar Outra Forma</button>
        <button id="calcular">Calcular</button>
    </div>
    
    <div class="result-section">
        <h2>Resultado</h2>
        <div id="resultado"></div>
    </div>

    <script>
        // Formas de pagamento disponíveis
        const bandeirasCartao = ['AMEX', 'DINERS', 'ELO', 'HIPERCARD', 'MASTERCARD', 'VISA'];
        const tiposCartao = ['Crédito', 'Débito', 'E-commerce'];
        const outrasFormasPagamento = ['Cash', 'Transferência Bancária', 'Faturamento'];
        const adquirentesDisponiveis = ['CIELO', 'GETNET', 'OUTROS'];
        
        // Elementos do DOM
        const formasPagamentoContainer = document.getElementById('formas-pagamento-container');
        const btnAdicionarCartao = document.getElementById('adicionar-cartao');
        const btnAdicionarOutraForma = document.getElementById('adicionar-outra-forma');
        const btnCalcular = document.getElementById('calcular');
        const resultadoDiv = document.getElementById('resultado');
        
        // Adicionar forma de pagamento com cartão
        btnAdicionarCartao.addEventListener('click', function() {
            const formaPagamentoDiv = document.createElement('div');
            formaPagamentoDiv.className = 'forma-pagamento-group';
            formaPagamentoDiv.innerHTML = `
                <div class="input-group">
                    <label>Forma de Pagamento:</label>
                    <select class="forma-pagamento">
                        <option value="">Selecione...</option>
                        ${bandeirasCartao.map(b => `<option value="${b}">${b}</option>`).join('')}
                    </select>
                </div>
                <div class="tipo-cartao">
                    <div class="input-group">
                        <label>Tipo:</label>
                        <select class="tipo">
                            ${tiposCartao.map(t => `<option value="${t}">${t}</option>`).join('')}
                        </select>
                    </div>
                    ${adquirentesDisponiveis.map(a => `
                        <div class="input-group">
                            <label>${a} (R$):</label>
                            <input type="text" class="adquirente" data-adquirente="${a}" placeholder="0,00" value="0,00">
                        </div>
                    `).join('')}
                </div>
                <button class="remover-forma">Remover</button>
            `;
            
            formasPagamentoContainer.appendChild(formaPagamentoDiv);
            
            // Adicionar evento ao botão de remover
            formaPagamentoDiv.querySelector('.remover-forma').addEventListener('click', function() {
                formasPagamentoContainer.removeChild(formaPagamentoDiv);
            });
        });
        
        // Adicionar outras formas de pagamento
        btnAdicionarOutraForma.addEventListener('click', function() {
            const formaPagamentoDiv = document.createElement('div');
            formaPagamentoDiv.className = 'forma-pagamento-group';
            formaPagamentoDiv.innerHTML = `
                <div class="input-group">
                    <label>Forma de Pagamento:</label>
                    <select class="forma-pagamento">
                        <option value="">Selecione...</option>
                        ${outrasFormasPagamento.map(f => `<option value="${f}">${f}</option>`).join('')}
                    </select>
                </div>
                <div class="input-group">
                    <label>Valor (R$):</label>
                    <input type="text" class="valor-outra-forma" placeholder="0,00" value="0,00">
                </div>
                <button class="remover-forma">Remover</button>
            `;
            
            formasPagamentoContainer.appendChild(formaPagamentoDiv);
            
            // Adicionar evento ao botão de remover
            formaPagamentoDiv.querySelector('.remover-forma').addEventListener('click', function() {
                formasPagamentoContainer.removeChild(formaPagamentoDiv);
            });
        });
        
        // Adicionar formas de pagamento de exemplo
        document.addEventListener('DOMContentLoaded', function() {
            // Exemplo de cartões
            adicionarCartaoExemplo('MASTERCARD', 'Crédito', {'CIELO': '3.162,18'});
            adicionarCartaoExemplo('VISA', 'Débito', {'CIELO': '1.136,12'});
            adicionarCartaoExemplo('ELO', 'E-commerce', {'GETNET': '429,62'});
            
            // Exemplo de outras formas
            adicionarOutraFormaExemplo('Cash', '1.500,00');
            adicionarOutraFormaExemplo('Transferência Bancária', '2.300,00');
            adicionarOutraFormaExemplo('Faturamento', '4.755,68');
        });
        
        function adicionarCartaoExemplo(bandeira, tipo, valores) {
            const formaPagamentoDiv = document.createElement('div');
            formaPagamentoDiv.className = 'forma-pagamento-group';
            formaPagamentoDiv.innerHTML = `
                <div class="input-group">
                    <label>Forma de Pagamento:</label>
                    <select class="forma-pagamento">
                        <option value="">Selecione...</option>
                        ${bandeirasCartao.map(b => 
                            `<option value="${b}" ${b === bandeira ? 'selected' : ''}>${b}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="tipo-cartao">
                    <div class="input-group">
                        <label>Tipo:</label>
                        <select class="tipo">
                            ${tiposCartao.map(t => 
                                `<option value="${t}" ${t === tipo ? 'selected' : ''}>${t}</option>`
                            ).join('')}
                        </select>
                    </div>
                    ${adquirentesDisponiveis.map(a => `
                        <div class="input-group">
                            <label>${a} (R$):</label>
                            <input type="text" class="adquirente" data-adquirente="${a}" 
                                   placeholder="0,00" value="${valores[a] || '0,00'}">
                        </div>
                    `).join('')}
                </div>
                <button class="remover-forma">Remover</button>
            `;
            
            formasPagamentoContainer.appendChild(formaPagamentoDiv);
            
            formaPagamentoDiv.querySelector('.remover-forma').addEventListener('click', function() {
                formasPagamentoContainer.removeChild(formaPagamentoDiv);
            });
        }
        
        function adicionarOutraFormaExemplo(forma, valor) {
            const formaPagamentoDiv = document.createElement('div');
            formaPagamentoDiv.className = 'forma-pagamento-group';
            formaPagamentoDiv.innerHTML = `
                <div class="input-group">
                    <label>Forma de Pagamento:</label>
                    <select class="forma-pagamento">
                        <option value="">Selecione...</option>
                        ${outrasFormasPagamento.map(f => 
                            `<option value="${f}" ${f === forma ? 'selected' : ''}>${f}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="input-group">
                    <label>Valor (R$):</label>
                    <input type="text" class="valor-outra-forma" placeholder="0,00" value="${valor}">
                </div>
                <button class="remover-forma">Remover</button>
            `;
            
            formasPagamentoContainer.appendChild(formaPagamentoDiv);
            
            formaPagamentoDiv.querySelector('.remover-forma').addEventListener('click', function() {
                formasPagamentoContainer.removeChild(formaPagamentoDiv);
            });
        }
        
        // Converter valor para número
        function parseValor(valorStr) {
            if (!valorStr) return 0;
            return parseFloat(valorStr.replace(/\./g, '').replace(',', '.'));
        }
        
        // Formatador de moeda
        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        
        // Calcular totais
        btnCalcular.addEventListener('click', function() {
            const data = document.getElementById('data').value;
            const movimento = parseValor(document.getElementById('movimento').value);
            
            // Coletar dados das formas de pagamento
            const formasPagamento = document.querySelectorAll('.forma-pagamento-group');
            const cartoesData = {};
            const outrasFormasData = {};
            
            formasPagamento.forEach(formaDiv => {
                const formaPagamento = formaDiv.querySelector('.forma-pagamento').value;
                
                // Verificar se é cartão ou outra forma
                const valorOutraFormaInput = formaDiv.querySelector('.valor-outra-forma');
                
                if (valorOutraFormaInput) {
                    // É outra forma de pagamento
                    const valor = parseValor(valorOutraFormaInput.value);
                    outrasFormasData[formaPagamento] = (outrasFormasData[formaPagamento] || 0) + valor;
                } else {
                    // É cartão
                    const tipo = formaDiv.querySelector('.tipo').value;
                    const bandeira = formaPagamento;
                    const inputs = formaDiv.querySelectorAll('.adquirente');
                    
                    const chave = `${bandeira} (${tipo})`;
                    
                    if (!cartoesData[chave]) {
                        cartoesData[chave] = {total: 0, adquirentes: {}};
                    }
                    
                    inputs.forEach(input => {
                        const adquirente = input.dataset.adquirente;
                        const valor = parseValor(input.value);
                        
                        cartoesData[chave].total += valor;
                        cartoesData[chave].adquirentes[adquirente] = 
                            (cartoesData[chave].adquirentes[adquirente] || 0) + valor;
                    });
                }
            });
            
            // Calcular totais por adquirente para cartões
            const totaisAdquirentes = {};
            adquirentesDisponiveis.forEach(a => {
                totaisAdquirentes[a] = 0;
            });
            
            Object.values(cartoesData).forEach(cartao => {
                Object.entries(cartao.adquirentes).forEach(([adquirente, valor]) => {
                    if (totaisAdquirentes[adquirente] !== undefined) {
                        totaisAdquirentes[adquirente] += valor;
                    }
                });
            });
            
            // Calcular total cartões
            const totalCartoes = Object.values(cartoesData).reduce((sum, cartao) => sum + cartao.total, 0);
            
            // Calcular total outras formas
            const totalOutrasFormas = Object.values(outrasFormasData).reduce((sum, val) => sum + val, 0);
            
            // Verificar se o caixa está correto
            const totalCalculado = totalCartoes + totalOutrasFormas;
            const caixaCorreto = Math.abs(totalCalculado - movimento) < 0.01;
            
            // Gerar tabela de resultados
            let html = `
                <table>
                    <tr>
                        <th>DATA:</th>
                        <td colspan="5">${data}</td>
                    </tr>
                    <tr>
                        <th>MOVIMENTO TOTAL</th>
                        <td colspan="5">R$ ${formatarMoeda(movimento)}</td>
                    </tr>
                    <tr>
                        <th>FORMA DE PAGAMENTO</th>
                        <th>CIELO</th>
                        <th>GETNET</th>
                        <th>OUTROS</th>
                        <th>TOTAL</th>
                        <th>STATUS</th>
                    </tr>
            `;
            
            // Adicionar linhas para cada cartão
            Object.entries(cartoesData).forEach(([descricao, dados]) => {
                html += `
                    <tr>
                        <td>${descricao}</td>
                        <td>R$ ${formatarMoeda(dados.adquirentes['CIELO'] || 0)}</td>
                        <td>R$ ${formatarMoeda(dados.adquirentes['GETNET'] || 0)}</td>
                        <td>R$ ${formatarMoeda(dados.adquirentes['OUTROS'] || 0)}</td>
                        <td>R$ ${formatarMoeda(dados.total)}</td>
                        <td></td>
                    </tr>
                `;
            });
            
            // Adicionar subtotal cartões
            html += `
                <tr class="total-row">
                    <td>TOTAL CARTÕES</td>
                    <td>R$ ${formatarMoeda(totaisAdquirentes['CIELO'])}</td>
                    <td>R$ ${formatarMoeda(totaisAdquirentes['GETNET'])}</td>
                    <td>R$ ${formatarMoeda(totaisAdquirentes['OUTROS'])}</td>
                    <td>R$ ${formatarMoeda(totalCartoes)}</td>
                    <td></td>
                </tr>
            `;
            
            // Adicionar outras formas de pagamento
            Object.entries(outrasFormasData).forEach(([forma, valor]) => {
                html += `
                    <tr>
                        <td>${forma}</td>
                        <td colspan="3"></td>
                        <td>R$ ${formatarMoeda(valor)}</td>
                        <td></td>
                    </tr>
                `;
            });
            
            // Adicionar total geral
            html += `
                <tr class="total-row">
                    <td>TOTAL GERAL</td>
                    <td colspan="3"></td>
                    <td>R$ ${formatarMoeda(totalCalculado)}</td>
                    <td class="${caixaCorreto ? 'status-correct' : 'status-incorrect'}">
                        ${caixaCorreto ? 'CAIXA CORRETO' : 'CAIXA INCORRETO'}
                    </td>
                </tr>
            `;
            
            html += `</table>`;
            
            // Adicionar campos de auditoria
            html += `
                <div style="margin-top: 20px;">
                    <p><strong>AUDITOR:</strong> _________________________</p>
                    <p><strong>OBSERVAÇÃO:</strong> _________________________</p>
                </div>
            `;
            
            resultadoDiv.innerHTML = html;
        });
    </script>
</body>
</html>
